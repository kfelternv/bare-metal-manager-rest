# SPDX-FileCopyrightText: Copyright (c) 2026 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Keycloak realm configuration for carbide-dev
apiVersion: v1
kind: ConfigMap
metadata:
  name: keycloak-realm
  labels:
    app: keycloak
data:
  carbide-dev-realm.json: |
    {
      "realm": "carbide-dev",
      "enabled": true,
      "displayName": "Carbide Development",
      "sslRequired": "none",
      "registrationAllowed": false,
      "loginWithEmailAllowed": true,
      "duplicateEmailsAllowed": false,
      "resetPasswordAllowed": true,
      "editUsernameAllowed": false,
      "bruteForceProtected": true,
      "roles": {
        "realm": [
          {
            "name": "test-org:FORGE_PROVIDER_ADMIN",
            "description": "Provider Admin role for test-org"
          },
          {
            "name": "test-org:FORGE_TENANT_ADMIN",
            "description": "Tenant Admin role for test-org"
          },
          {
            "name": "test-org:FORGE_PROVIDER_VIEWER",
            "description": "Provider Viewer role for test-org"
          },
          {
            "name": "admin",
            "description": "Administrator role"
          },
          {
            "name": "user",
            "description": "Regular user role"
          }
        ],
        "client": {
          "carbide-api": [
            {
              "name": "api-access",
              "description": "Access to Carbide API"
            }
          ]
        }
      },
      "clients": [
        {
          "clientId": "carbide-api",
          "name": "Carbide API",
          "enabled": true,
          "clientAuthenticatorType": "client-secret",
          "secret": "carbide-local-secret",
          "redirectUris": [
            "http://localhost:8388/*",
            "http://localhost:3000/*"
          ],
          "webOrigins": [
            "http://localhost:8388",
            "http://localhost:3000"
          ],
          "publicClient": false,
          "protocol": "openid-connect",
          "directAccessGrantsEnabled": true,
          "serviceAccountsEnabled": true,
          "authorizationServicesEnabled": false,
          "standardFlowEnabled": true,
          "implicitFlowEnabled": false,
          "fullScopeAllowed": true,
          "defaultClientScopes": [
            "web-origins",
            "acr",
            "profile",
            "roles",
            "email"
          ],
          "optionalClientScopes": [
            "address",
            "phone",
            "offline_access",
            "microprofile-jwt"
          ],
          "protocolMappers": [
            {
              "name": "audience",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-audience-mapper",
              "consentRequired": false,
              "config": {
                "included.client.audience": "carbide-api",
                "id.token.claim": "true",
                "access.token.claim": "true"
              }
            },
            {
              "name": "oidc_id",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "config": {
                "user.attribute": "oidc_id",
                "claim.name": "oidc_id",
                "jsonType.label": "String",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "userinfo.token.claim": "true"
              }
            }
          ]
        }
      ],
      "users": [
        {
          "username": "testuser",
          "email": "testuser@example.com",
          "emailVerified": true,
          "enabled": true,
          "firstName": "Test",
          "lastName": "User",
          "credentials": [
            {
              "type": "password",
              "value": "testpassword",
              "temporary": false
            }
          ],
          "realmRoles": [
            "user",
            "test-org:FORGE_TENANT_ADMIN"
          ],
          "clientRoles": {
            "carbide-api": [
              "api-access"
            ]
          },
          "attributes": {
            "oidc_id": ["testuser-oidc-001"]
          }
        },
        {
          "username": "admin",
          "email": "admin@example.com",
          "emailVerified": true,
          "enabled": true,
          "firstName": "Admin",
          "lastName": "User",
          "credentials": [
            {
              "type": "password",
              "value": "adminpassword",
              "temporary": false
            }
          ],
          "realmRoles": [
            "admin",
            "user",
            "test-org:FORGE_PROVIDER_ADMIN",
            "test-org:FORGE_TENANT_ADMIN"
          ],
          "clientRoles": {
            "carbide-api": [
              "api-access"
            ]
          },
          "attributes": {
            "oidc_id": ["admin-oidc-001"]
          }
        },
        {
          "username": "provider",
          "email": "provider@example.com",
          "emailVerified": true,
          "enabled": true,
          "firstName": "Provider",
          "lastName": "Admin",
          "credentials": [
            {
              "type": "password",
              "value": "providerpassword",
              "temporary": false
            }
          ],
          "realmRoles": [
            "user",
            "test-org:FORGE_PROVIDER_ADMIN"
          ],
          "clientRoles": {
            "carbide-api": [
              "api-access"
            ]
          },
          "attributes": {
            "oidc_id": ["provider-oidc-001"]
          }
        }
      ],
      "defaultDefaultClientScopes": [
        "role_list",
        "profile",
        "email",
        "roles",
        "web-origins",
        "acr"
      ],
      "defaultOptionalClientScopes": [
        "offline_access",
        "address",
        "phone",
        "microprofile-jwt"
      ]
    }
